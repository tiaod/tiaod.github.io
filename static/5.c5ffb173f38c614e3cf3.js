webpackJsonp([5],{6:function(e,t){e.exports={methods:{toggleSidebar:function(){return $(".ui.sidebar").sidebar("toggle")}}}},7:function(e,t){e.exports='<div v-show=!isSidebarHidden class="ui top fixed borderless menu"><a @click=toggleSidebar class="launch icon item"><slot name=toggleButton><i class="content icon"></i></slot></a><slot></slot></div>'},8:function(e,t,a){var i,s;i=a(6),s=a(7),e.exports=i||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)},163:function(e,t,a){var i,s,r;i=a(5)("loginWithWeibo"),s=a(1),r=a(10),e.exports={data:function(){return{userData:null,loading:!1,firstAuth:!1}},components:{navbar:a(8)},computed:{showCard:function(){return null!=this.userData&&!this.loading&&this.firstAuth}},methods:{useWeiboInfo:function(){var e,t;return t=this,null!=this.currentUser?(i("使用当前微博提供的用户信息"),this.currentUser.set("username",this.userData.name),e=AV.File.withURL("avatar.jpg",this.userData.avatar_large),this.loading=!0,e.save().then(function(e){return function(t){return e.currentUser.set("avatar",t),e.currentUser.save().then(function(t){return i("保存 用户信息成功！",t),e.$router.go({name:"messages"})})["catch"](function(t){return i("保存用户信息失败！",t),e.loading=!1})}}(this))["catch"](function(e){return i("头像上传失败。",e)})):void 0}},filters:{fromNow:function(e){return s(new Date(e)).fromNow()}},ready:function(){var e;return $(this.$el.querySelector(".dimmer")).dimmer({on:"hover"}),e=this.$route.query.code,null!=e?AV.Cloud.run("auth_weibo",{code:e},{success:function(e){return function(t){return i("获得了登陆信息：",t),e.userData=t.user_data,e.becomeUser(t.token)}}(this),error:function(e){return function(t){i("微博登陆失败：",t),r.error(t.message.error_description,"微博登陆失败"),e.$router.go({name:"login"})}}(this)}):void 0},vuex:{getters:{currentUser:function(e){return e.accounts.currentUser}},actions:{becomeUser:function(e,t){var a,s;return a=e.dispatch,s=e.state,AV.User.become(t).then(function(e){return function(t){i(t),i("登陆成功！当前用户为:",AV.User.current()),a("SET_CURRENT_USER",t),null!=t.get("avatar")?(r.success("授权成功！欢迎回来。"),e.$router.go({name:"messages"})):e.firstAuth=!0}}(this))["catch"](function(e){return function(t){r.error(err.message,"用户登陆失败。"),e.$router.go({name:"login"})}}(this))}}}}},192:function(e,t,a){t=e.exports=a(2)(),t.push([e.id,".ui.card[_v-02ea9f4d]{margin:0 auto}","",{version:3,sources:["/./src/industrywar/pages/accounts/loginWeibo.vue"],names:[],mappings:"AAAA,sBACE,aAAe,CAChB",file:"loginWeibo.vue",sourcesContent:[".ui.card[_v-02ea9f4d] {\n  margin: 0 auto;\n}"],sourceRoot:"webpack://"}])},215:function(e,t,a){var i=a(192);"string"==typeof i&&(i=[[e.id,i,""]]);a(4)(i,{});i.locals&&(e.exports=i.locals)},255:function(e,t){e.exports='<div class="ui container" _v-02ea9f4d=""><navbar _v-02ea9f4d=""><div class=item _v-02ea9f4d="">微博登陆</div></navbar><div class="ui padded stackable grid" _v-02ea9f4d=""><div class=row _v-02ea9f4d=""><div class=column _v-02ea9f4d=""><div class="ui breadcrumb" _v-02ea9f4d=""><a v-link="{name:\'login\'}" class=section _v-02ea9f4d="">登陆</a><div class=divider _v-02ea9f4d="">/</div><div class="active section" _v-02ea9f4d="">微博登陆</div></div><div class="ui info message" _v-02ea9f4d=""><i class="weibo icon" _v-02ea9f4d=""></i>确认你的微博账号信息</div></div></div><div class="two column row" _v-02ea9f4d=""><div v-if=!showCard class=column _v-02ea9f4d=""><div class="ui active centered large inline loader" _v-02ea9f4d=""></div></div><div v-if=showCard class=column _v-02ea9f4d=""><div class="ui card" _v-02ea9f4d=""><div class="blurring dummable image" _v-02ea9f4d=""><div class="ui dimmer" _v-02ea9f4d=""><div class=content _v-02ea9f4d=""><div class=center _v-02ea9f4d=""><div class="ui inverted button" _v-02ea9f4d="">替换头像</div></div></div></div><img :src=userData.avatar_large _v-02ea9f4d=""></div><div class=content _v-02ea9f4d=""><a class=header _v-02ea9f4d="">{{ userData.name }}</a><div class=meta _v-02ea9f4d=""> {{ userData.location }}，创建于 {{ userData.created_at | fromNow }}</div></div><div class="extra content" _v-02ea9f4d=""><div class="right floated" _v-02ea9f4d=""><div v-show=!loading transition=semantic v-link="{name:\'map\'}" class="ui button transition fade left" _v-02ea9f4d="">不使用</div><div @click=useWeiboInfo :class={loading:loading} class="ui primary button" _v-02ea9f4d="">使用这些信息</div></div></div></div></div><div class=column _v-02ea9f4d=""></div></div></div></div>'},274:function(e,t,a){var i,s;a(215),i=a(163),s=a(255),e.exports=i||{},e.exports.__esModule&&(e.exports=e.exports["default"]),s&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=s)}});
//# sourceMappingURL=5.c5ffb173f38c614e3cf3.js.map